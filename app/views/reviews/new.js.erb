// Links with write a review link on book show page 
// creates a Review object from json and compiles it into handlebars
// renders form partial from handlebars (_formatted.html.erb) and escapes the html with js



$("#book_review").hide().after('<%= j render("form") %>');

function Review(attributes){
  this.comment = attributes.comment;
  this.rating = attributes.rating;
  this.id = attributes.id;
  this.user_id = attributes.user_id;
  this.created_at = attributes.created_at;
}


//wait for page to load
$(function(){
  $('#new_review').on('submit', function(e) {
    
    var $form = $(this);
    var action = $form.attr("action");
    // The attr() method sets or returns attributes and values of the selected elements.
    var params = $form.serialize();
    // The serialize() method creates a URL encoded text string by serializing form values.
    // The serialized values can be used in the URL query string when making an AJAX request.

    $.ajax({
        url: action,
        data: params,
        dataType: "json",
        method: "POST",
        success: function(json) {
          var source   = $("#entry-template").html();
          // Compile the source info from the form into a handlebars template
          var template = Handlebars.compile(source);
          var html    = template(json);
          // console.log(json)
          // Render the review into the page
          $("#place-here").prepend(html);
          // Hide the form after its submitted
          $("#new_review").hide()


      }, error:  function(jqxhr, textStatus, error) {
        console.log(jqxhr, textStatus, error)
      }

    })
    e.preventDefault();

  })

})
